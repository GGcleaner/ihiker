# iHiker 智能徒步助手项目说明文档

## 一、项目概述

**项目名称**：iHiker 智能徒步助手

**项目类型**：Web 应用（基于百度地图 API 的实时定位与轨迹记录系统）

**项目简介**：
 iHiker 是一款面向徒步爱好者的智能助手工具，能够实时记录用户的徒步轨迹、计算总距离、用时及平均速度，并可通过地图可视化显示徒步路线。用户可以随时清除轨迹重新开始记录，适用于短途徒步或日常锻炼记录。

------

## 二、功能描述

1. **实时定位**
   - 自动获取用户当前位置，通过浏览器地理定位 API 获取高精度坐标。
   - 支持多次定位取平均值，保证初始起点精确。
2. **轨迹记录**
   - 用户移动时，在地图上显示当前轨迹。
   - 路径通过折线（Polyline）可视化显示，起点位置使用标记（Marker）标出。
   - 设置移动距离阈值（5 米）避免噪声数据影响轨迹精度。
3. **数据统计**
   - 实时显示徒步总距离（米）、用时（秒）、平均速度（米/秒）。
   - 使用计时器实时更新数据。
4. **轨迹清除功能**
   - 点击“清除轨迹”按钮可以重置所有统计数据并清除地图上的轨迹。
   - 支持重新开始新一轮徒步记录。
5. **平滑地图显示**
   - 用户移动时，地图中心自动跟随当前位置移动，实现平滑跟随效果。

------

## 三、技术方案

1. **前端技术**
   - HTML5、CSS3、JavaScript
   - CSS 样式优化界面，增强用户体验（阴影、圆角、按钮悬停效果等）
2. **地图 API**
   - 百度地图 API v2.0
   - 提供地图显示、标记、折线绘制、距离计算等功能
3. **定位功能**
   - 使用浏览器 `navigator.geolocation` 获取地理位置
   - 支持 `enableHighAccuracy` 高精度定位
   - 多次取值平均降低定位误差
4. **数据计算**
   - 使用 `BMap.Map.getDistance()` 计算两点间距离
   - 累加距离并结合时间计算平均速度

------

## 四、系统结构

### 1. 文件结构

```
iHiker/
│
├─ index.html       # 页面结构
├─ style.css        # 页面样式
└─ script.js        # JavaScript 核心逻辑
```

### 2. 页面布局

- **Header**
  - 标题显示：“iHiker 智能徒步助手”
- **Main**
  - 地图容器 `#map` 占据 70% 视口高度
  - 数据统计 `#stats` 显示总距离、用时、平均速度及“清除轨迹”按钮

------

## 五、核心代码说明

1. **地图初始化**

```
var map = new BMap.Map("map");
map.addControl(new BMap.NavigationControl());
map.addControl(new BMap.ScaleControl());
```

- 初始化地图，添加导航控件和比例尺。

1. **起点定位**

```
getInitialPosition(5); // 连续获取5次，取平均值
```

- 多次获取位置平均减少误差。

1. **轨迹绘制与更新**

```
polyline = new BMap.Polyline(path, { strokeColor:"red", strokeWeight:5, strokeOpacity:0.8 });
map.addOverlay(polyline);
```

- 使用折线绘制轨迹，并随用户移动动态更新。

1. **距离与速度计算**

```
totalDistance += dist;
var speed = elapsed > 0 ? totalDistance / elapsed : 0;
```

- 实时累加移动距离并计算平均速度。

1. **重置轨迹**

```
document.getElementById('reset').addEventListener('click', function() {
    path = [];
    totalDistance = 0;
    startTime = new Date();
    lastPoint = null;
    ...
});
```

- 清除轨迹及统计数据，支持重新开始记录。

------

## 六、使用说明

1. 打开网页，允许浏览器获取当前位置权限。
2. 页面加载后，地图自动定位到起点位置，并显示当前位置标记。
3. 开始移动，轨迹、总距离、用时、平均速度实时更新。
4. 点击“清除轨迹”按钮可重置数据，重新开始记录。

------

## 七、注意事项

- 浏览器需支持 `navigator.geolocation` 功能。
- 百度地图 API Key 已配置，如需发布需替换为自己的 Key。
- 使用移动设备或带 GPS 的设备可获得更精确定位。
- 在室内或信号弱的环境下，定位精度可能下降。

------

## 八、改进方向

1. **轨迹平滑优化**：使用滤波算法减少噪声点。
2. **多平台适配**：支持手机端全屏展示和响应式布局。
3. **历史轨迹保存**：增加本地存储或服务器保存功能。
4. **界面优化**：增加地图缩放控制、轨迹颜色选择、轨迹分享功能。